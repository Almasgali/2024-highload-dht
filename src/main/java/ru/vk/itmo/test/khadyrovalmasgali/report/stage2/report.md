# Отчёт Stage 2
Specs

8-Core AMD Ryzen 7 4700U

16Gb RAM 2667 MHz

[lua get requests](./scripts/get.lua)

[lua put requests](./scripts/put.lua)

[wrk2 get output](./wrk/get.txt)

[wrk2 put output](./wrk/put.txt)

[get cpu profile](./asprof/get_cpu.html)

[put cpu profile](./asprof/put_cpu.html)

[get lock profile](./asprof/get_lock.html)

[put lock profile](./asprof/put_lock.html)

[get alloc profile](./asprof/get_alloc.html)

[put alloc profile](./asprof/put_alloc.html)

Тестирование проводилось на 8 (по числу ядер) потоках и 64 соединениях.
Для get - запросов предварительно были выгружены на диск ~150 sstable'ов.

### PUT

На 80к RPS (что ровно в 8 раз больше RPS'a, который приложение выдерживало
на первом этапе) получились такие результаты:

| Percentile | time    |
|------------|---------|
| 50.000%    | 1.44ms  |
| 75.000%    | 2.27ms  |
| 90.000%    | 5.49ms  |
| 99.000%    | 22.40ms |
| 99.900%    | 36.51ms |
| 99.990%    | 44.70ms |
| 99.999%    | 49.66ms |
| 100.000%   | 51.58ms |

Деградация на трех девятках довольно заметная, поэтому тестирование
проводилось на 70к RPS (полный вывод прикреплен).

Судя по профилям, работа по тредам была распределна довольно равномерно,
что хорошо.

### GET

65k RPS

| Percentile | time     |
|------------|----------|
| 50.000%    | 4.58ms   |
| 75.000%    | 10.26ms  |
| 90.000%    | 19.09ms  |
| 99.000%    | 46.43ms  |
| 99.900%    | 70.53ms  |
| 99.990%    | 91.90ms  |
| 99.999%    | 98.11ms  |
| 100.000%   | 100.67ms |

На трех девятках ситуация плачевная. Адекватной работы удалось добиться
на 50к RPS, вывод wrk прикреплен. В приципе, падение производительности по сравнению
с PUT - запросами ожидаемо - ходить по
табличкам на диске дорого, фильтр Блума в помощь.

На профилях работа равномерно распределена по потокам, львиная доля
ресурсов процессора все также уходит на бин. поиск.
